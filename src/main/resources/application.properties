spring.application.name=development-hour-management

# Dotenv configuration
spring.config.import=optional:classpath:.env[.properties],optional:file:.env[.properties]

# Database Configuration
spring.datasource.url=jdbc:mysql://localhost:3306/devhour_db?createDatabaseIfNotExist=true&useSSL=false&allowPublicKeyRetrieval=true
spring.datasource.username=devhour_user
spring.datasource.password=devhour_password
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# HikariCP Configuration
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000

# MyBatis Configuration
mybatis.configuration.map-underscore-to-camel-case=true
mybatis.type-aliases-package=com.devhour.domain.model
mybatis.type-handlers-package=com.devhour.infrastructure.typehandler
mybatis.configuration.default-fetch-size=100
mybatis.configuration.default-statement-timeout=30

# Flyway Configuration
spring.flyway.enabled=true
spring.flyway.locations=classpath:db/migration
spring.flyway.baseline-on-migrate=true

# JWT Configuration (will be overridden by environment variables in production)
app.jwt.secret=development-jwt-secret-key-not-for-production-change-this
app.jwt.expiration-ms=86400000
app.jwt.issuer=devhour-management

# Enable Okta Security (Resource Server mode)
security.okta.enabled=true

# Allow bean definition overriding for custom JWT converter
spring.main.allow-bean-definition-overriding=true

# Okta OAuth2 Configuration
# Using specific authorization server ausv0duqjyAMlQAr2697
okta.oauth2.issuer=https://integrator-7614169.okta.com/oauth2/ausv0duqjyAMlQAr2697
okta.oauth2.client-id=0oautxe876E1V68ml697
okta.oauth2.client-secret=${OKTA_CLIENT_SECRET:not-needed-for-resource-server}
okta.oauth2.scopes=openid,profile,email
okta.oauth2.redirect-uri=/authorization-code/callback

# Spring Security OAuth2 Resource Server
# Configures the application to validate JWT tokens from Okta
spring.security.oauth2.resourceserver.jwt.issuer-uri=https://integrator-7614169.okta.com/oauth2/ausv0duqjyAMlQAr2697
spring.security.oauth2.resourceserver.jwt.jwk-set-uri=https://integrator-7614169.okta.com/oauth2/ausv0duqjyAMlQAr2697/v1/keys

# Okta Configuration Properties (new configuration)
# Issuer URI and JWK Set URI for JWT token validation
okta.issuer-uri=https://integrator-7614169.okta.com/oauth2/ausv0duqjyAMlQAr2697
okta.jwk-set-uri=https://integrator-7614169.okta.com/oauth2/ausv0duqjyAMlQAr2697/v1/keys

# Okta Client Configuration
okta.client.token-expiry-tolerance=60

# Okta JWT Claim Mapping Configuration
okta.client.claim-mapping.user-id=sub
okta.client.claim-mapping.email=email
okta.client.claim-mapping.username=preferred_username
okta.client.claim-mapping.full-name=name

# Logging Configuration
logging.level.com.devhour=INFO
logging.level.com.devhour.presentation.controller=INFO
logging.level.com.devhour.infrastructure.security=INFO
logging.level.com.devhour.infrastructure.security.OktaJwtAuthenticationConverter=ERROR
logging.level.com.devhour.application.service.OktaUserSyncService=WARN
logging.level.org.mybatis=INFO
logging.level.org.mybatis.spring.SqlSessionUtils=WARN
logging.level.org.springframework.security=INFO
logging.level.org.springframework.security.oauth2=INFO
logging.level.org.springframework.security.access.method.AuthorizationManagerBeforeMethodInterceptor=ERROR
logging.level.org.springframework.security.oauth2.server.resource.web.authentication.BearerTokenAuthenticationFilter=WARN
logging.level.org.apache.kafka.clients.consumer.internals.ConsumerCoordinator=WARN

# JIRA Related Package Logging
logging.level.com.devhour.infrastructure.jira=DEBUG
logging.level.com.devhour.application.service.JiraSyncApplicationService=DEBUG
logging.level.com.devhour.application.service.JiraJqlQueryApplicationService=DEBUG
logging.level.com.devhour.application.service.JiraSyncHistoryApplicationService=DEBUG
logging.level.com.devhour.domain.service.JiraSyncDomainService=DEBUG
logging.level.com.devhour.scheduler.JiraSyncScheduler=DEBUG
logging.level.com.devhour.presentation.controller.JiraSyncController=DEBUG
logging.level.com.devhour.presentation.controller.JiraResponseTemplateController=DEBUG
logging.level.com.devhour.presentation.controller.JiraJqlQueryController=DEBUG

# AspectJ Logging Configuration
logging.level.com.devhour.infrastructure.aspect=INFO
# パフォーマンス監視の閾値（ミリ秒）
performance.slow-method-threshold=1000

# Logging pattern for console output
logging.pattern.console=%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n

spring.devtools.restart.enabled=true
spring.devtools.livereload.enabled=true

# Kafka Configuration (disabled by default)
spring.kafka.enabled=true
spring.kafka.bootstrap-servers=localhost:9092
spring.kafka.consumer.group-id=work-hours-approval-group
spring.kafka.consumer.auto-offset-reset=earliest
spring.kafka.consumer.key-deserializer=org.apache.kafka.common.serialization.StringDeserializer
spring.kafka.consumer.value-deserializer=org.springframework.kafka.support.serializer.JsonDeserializer
spring.kafka.consumer.properties.spring.json.trusted.packages=com.devhour.domain.event
spring.kafka.producer.key-serializer=org.apache.kafka.common.serialization.StringSerializer
spring.kafka.producer.value-serializer=org.springframework.kafka.support.serializer.JsonSerializer
spring.kafka.producer.acks=all

# OpenAPI/Swagger Configuration
springdoc.api-docs.path=/api-docs
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.swagger-ui.operations-sorter=method

# JIRA Integration Configuration
jira.base-url=${JIRA_BASE_URL:https://your-jira-instance.atlassian.net}
jira.api-version=2
jira.timeout.connection=30000
jira.timeout.read=60000
jira.retry.max-attempts=3
jira.retry.backoff-multiplier=2.0
jira.auth.username-env-key=JIRA_USERNAME
jira.auth.token-env-key=JIRA_API_TOKEN

# JIRA Sync Scheduler Configuration
jira.sync.scheduler.enabled=true
jira.sync.scheduler.cron=*/5 * * * * *
jira.sync.scheduler.lock-at-most-for=PT10M
jira.sync.scheduler.lock-at-least-for=PT1M

# JIRA Sync Batch Processing Configuration
jira.sync.batch-size=100
jira.sync.memory-efficient-processing=true
jira.sync.progress-logging.enabled=true
jira.sync.progress-logging.interval=10
jira.sync.streaming.chunk-size=50
jira.sync.performance-monitoring.enabled=true

# Disable Spring Boot HTTP client autoconfiguration
spring.autoconfigure.exclude=org.springframework.boot.autoconfigure.http.client.HttpClientAutoConfiguration,org.springframework.boot.autoconfigure.web.client.RestClientAutoConfiguration

# Project Status Mapping Configuration
# Maps JIRA status strings to internal ProjectStatus enum values
project.status.mapping.in-progress=ACTIVE,IN_PROGRESS,STARTED,ONGOING
project.status.mapping.completed=COMPLETED,DONE,FINISHED,RESOLVED,CLOSED
project.status.mapping.cancelled=CANCELLED,CANCELED,ABANDONED,REJECTED
project.status.mapping.planning=PLANNING,NEW,OPEN,TO_DO,BACKLOG
project.status.mapping.default-status=PLANNING